#!/usr/bin/env bash
# Context Engine CLI - Simple wrapper for easy access
# Usage: ./ce <command> [options]

set -e

CE_ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# Color codes for output
GREEN='\033[0;32m'
RED='\033[0;31m'
NC='\033[0m'

case "$1" in
  init|start)
    # Initialize new session
    "$CE_ROOT/scripts/init-session.sh" "${@:2}"
    ;;

  archive|end)
    # Archive completed session
    "$CE_ROOT/scripts/archive-task.sh" "${@:2}"
    ;;

  search)
    # Keyword search in knowledge base
    "$CE_ROOT/scripts/search-knowledge.sh" "${@:2}"
    ;;

  vsearch)
    # Vector/semantic search
    python3 "$CE_ROOT/scripts/vector-search.py" "${@:2}"
    ;;

  run)
    # Run command with automatic error capture
    echo -e "${GREEN}Running with error capture:${NC} ${@:2}"
    python3 "$CE_ROOT/scripts/error-monitor.py" --run "${@:2}"
    ;;

  extract)
    # Check/create extraction prompts
    python3 "$CE_ROOT/scripts/smart-prompt-helper.py" "${@:2}"
    ;;

  status)
    # Check session status
    python3 "$CE_ROOT/scripts/session-orchestrator.py" idle
    ;;

  help|--help|-h)
    echo "Context Engine CLI"
    echo ""
    echo "Usage: ./ce <command> [options]"
    echo ""
    echo "Commands:"
    echo "  init <task>     Start new session"
    echo "  archive         Archive completed task"
    echo "  search <term>   Keyword search in knowledge"
    echo "  vsearch <term>  Semantic/vector search"
    echo "  run <command>   Run command with auto error capture"
    echo "  extract         Check/create extraction prompts"
    echo "  status          Check session status"
    echo "  help            Show this help message"
    echo ""
    echo "Examples:"
    echo "  ./ce init \"implement-jwt-auth\""
    echo "  ./ce search authentication"
    echo "  ./ce run npm test"
    echo "  ./ce vsearch \"jwt token issues\""
    ;;

  "")
    echo -e "${RED}Error: No command specified${NC}"
    echo "Run './ce help' for usage information"
    exit 1
    ;;

  *)
    echo -e "${RED}Error: Unknown command '${1}'${NC}"
    echo "Run './ce help' for available commands"
    exit 1
    ;;
esac
